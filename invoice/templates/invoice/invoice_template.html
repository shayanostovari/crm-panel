
{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <title>فاکتور {{ object.invoice_number }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
      /* فونت‌های Embed شده از ویو */
      {% if font_data %}
      @font-face {
        font-family: 'VazirmatnEmbed';
        src: url("{{ font_data }}") format("truetype");
        font-weight: normal;
        font-style: normal;
        font-display: swap;
      }
      {% endif %}
      {% if font_data_bold %}
      @font-face {
        font-family: 'VazirmatnEmbed';
        src: url("{{ font_data_bold }}") format("truetype");
        font-weight: bold;
        font-style: normal;
        font-display: swap;
      }
      {% endif %}

      body {
        font-family: {% if font_data %}'VazirmatnEmbed', {% endif %} Tahoma, Arial, sans-serif;
        color: #222;
        direction: rtl;
        margin: 0;
        background: #f5f5f5;
      }

      * { box-sizing: border-box; }

      .container {
        width: 100%;
        min-height: 100vh;
        padding: 20px 0;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
      }

      .first-red-section, .second-red-section {
        width: 50px;
        height: 300px;
        background: #c62828;
        position: absolute;
        z-index: 1;
      }
      .first-red-section { right: -50px; top: 40px; }
      .second-red-section { left: -50px; bottom: 40px; }

      .a4-page {
        width: 794px;
        background: #fff;
        border: 1px solid #111;
        padding: 20mm;
        display: flex;
        flex-direction: column;
        z-index: 2;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
        margin-bottom: 12px;
      }

      .company-block { display: flex; gap: 12px; align-items: flex-start; }
      .logo { max-width: 90px; height: auto; object-fit: contain; }
      .company-text h3 { font-size: 18px; margin: 0 0 4px 0; }
      .company-text p { margin: 2px 0; font-size: 12px; }

      .meta-block p { font-size: 13px; margin: 2px 0; text-align: left; }

      table { width: 100%; border-collapse: collapse; font-size: 13px; margin: 16px 0; }
      th, td { border: 1px solid #111; padding: 8px; vertical-align: top; }
      .header-row td { border: none; font-weight: 700; padding: 6px 8px; }
      .header-row { text-align: right; }

      .service-name { font-weight: 700; }
      .center { text-align: center; }
      .right { text-align: right; }

      .desc-row {
        border-left: 1px solid #111;
        border-right: 1px solid #111;
        border-bottom: 1px solid #111;
        padding: 6px 8px;
        background: #fafafa;
        font-size: 12px;
        color: #333;
      }

      .summary-row td { font-weight: 700; background: #fff; }

      section { margin-top: 12px; font-size: 13px; }
      section h3 { margin-bottom: 8px; font-size: 15px; }
      section ul { margin: 6px 0 12px 18px; }

      .contact-payment-info {
        margin-top: 12px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
      }
      .support { color: #c62828; font-weight: 700; }
      .paymentNumber { font-weight: 700; }

      .sign { margin-top: 18px; text-align: left; }

      .invoice-footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        gap: 12px;
        align-items: flex-start;
        font-weight: 700;
      }
      .invoice-footer .f-col {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .invoice-footer img { width: 24px; height: 24px; }

      @page { size: A4; margin: 10mm; }
      @media print {
        html, body { background: white; }
        .a4-page { box-shadow: none; padding: 12mm; border: 1px solid #111; }
        header, section, footer { break-inside: avoid; }
      }

      @media (max-width: 820px) {
        .a4-page { width: calc(100vw - 40px); padding: 12px; }
        .first-red-section, .second-red-section { display: none; }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="first-red-section"></div>

      <div class="a4-page">
        <header>
          <div class="company-block">
            {% if logo_data %}
              <img class="logo" src="{{ logo_data }}" alt="logo" />
            {% else %}
              <div class="logo-placeholder">لوگو</div>
            {% endif %}
            <div class="company-text">
              <h3>کانون آگهی و تبلیغات بازارسازان هوشمند پویا</h3>
              <p>دارای مجوز رسمی از وزارت فرهنگ و ارشاد اسلامی</p>
              <p>شماره مجوز: {{ object.license_number }}</p>
            </div>
          </div>

          <div class="meta-block">
            <p><strong>شماره فاکتور:</strong> {{ object.invoice_number }}</p>
            <p><strong>تاریخ:</strong> {{ object.get_jalali_date }}</p>
          </div>
        </header>

        <table>
          <tr class="header-row">
            <td colspan="2">نام صنف: <strong>{{ object.business_name }}</strong></td>
            <td colspan="2">مدیریت: <strong>{{ object.agency_manager }}</strong></td>
          </tr>
          <tr class="header-row">
            <td colspan="4">آدرس: {{ object.address|default:"-" }}</td>
          </tr>
          <tr class="header-row">
            <td colspan="4">تماس: {{ object.phone_number|default:"-" }}</td>
          </tr>

          <tr>
            <th style="width:35%;">نام خدمات</th>
            <th style="width:15%;">تعداد</th>
            <th style="width:25%;">مبلغ واحد (ریال)</th>
            <th style="width:25%;">مبلغ کل (ریال)</th>
          </tr>

          {% for s in services %}
          <tr>
            <td class="service-name">{{ s.get_service_name_display }}</td>
            <td class="center">{{ s.quantity }}</td>
            <td class="right">{{ s.amount|intcomma }}</td>
            <td class="right">{{ s.total|intcomma }}</td>
          </tr>
          <tr>
            <td colspan="4" class="desc-row">
              {% if s.description %}
                {{ s.description|linebreaksbr }}
              {% else %}
                —
              {% endif %}
            </td>
          </tr>
          {% endfor %}

          {% if not services %}
          <tr>
            <td colspan="4" style="text-align:center;">هیچ خدمتی ثبت نشده است</td>
          </tr>
          {% endif %}

          <tr class="summary-row">
            <td colspan="2" style="text-align:right">کد مشاور: -</td>
            <td colspan="2" style="text-align:right"><strong>جمع فاکتور: {{ total|intcomma }} ریال</strong></td>
          </tr>
        </table>

        <section>
          <h3>شرح خدمات:</h3>
          <ul>
            <li>با دریافت خدمات می‌توانید از ساعت ۱۰ صبح الی ۱۸ بعدازظهر با مشاورین بازرگانی ما در زمینه بهبود فروش و بازاریابی برای کسب و کارتان مشورت بگیرید.</li>
            <li>تمامی موارد ذکر شده پس از واریز وجه، در مدت ۲۰ روز کاری، نشر و به شما نمایش داده خواهد شد.</li>
          </ul>

          <div class="contact-payment-info">
            <p class="support">تماس با پشتیبانی (واتساپ): <strong>09923823039</strong></p>
            <p class="paymentNumber">شماره کارت: <strong>5041-7210-4950-9285</strong> (علیرضا حسینعلی - بانک رسالت)</p>
            <p class="paymentNumber">شماره شبا: <strong>IR970700001000115568446001</strong> (علیرضا حسینعلی)</p>
          </div>

          <p class="sign">امضا تحویل‌گیرنده:</p>
        </section>

        <footer class="invoice-footer">
          <div class="f-col">
            {% if phone_icon %}<img src="{{ phone_icon }}" alt="phone" />{% endif %}
            <p>44782351 - 44780156</p>
          </div>
          <div class="f-col">
            {% if msg_icon %}<img src="{{ msg_icon }}" alt="msg" />{% endif %}
            <p>www.asnafshahr.com</p>
          </div>
          <div class="f-col address-col">
            {% if telegram_icon %}<img src="{{ telegram_icon }}" alt="telegram" />{% endif %}
            <p>تهران، کیلومتر ۱۴ جاده مخصوص، خیابان ۵۵ شهرک غزالی، نبش خیابان توران پشتی، پلاک ۱</p>
          </div>
        </footer>
      </div>

      <div class="second-red-section"></div>
    </div>
  </body>
</html>
